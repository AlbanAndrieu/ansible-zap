# This file was generated by ansible for albandri-laptop-misys.misys.global.ad
#FROM debian:jessie
FROM ubuntu:16.04

# Volume can be accessed outside of container
VOLUME [/usr/local/zap]

MAINTAINER Alban Andrieu "https://github.com/AlbanAndrieu"

ENV DEBIAN_FRONTEND noninteractive
ENV ZAP_HOME /usr/local/zap/zap-2.3.0
ENV WORKDIR /home/vagrant

# Working dir
WORKDIR /home/vagrant

# Because docker replaces /sbin/init: https://github.com/dotcloud/docker/issues/1024
#RUN dpkg-divert --local --rename --add /sbin/initctl

# Make sure the package repository is up to date.
RUN apt-get clean && apt-get -y update

# Install ansible
RUN apt-get install -y git unzip python-dev python-yaml python-jinja2 python-pip ansible

# ADD
ADD defaults $WORKDIR/ansible-zap/defaults
ADD meta $WORKDIR/ansible-zap/meta
#ADD files $WORKDIR/ansible-zap/files
ADD handlers $WORKDIR/ansible-zap/handlers
ADD tasks $WORKDIR/ansible-zap/tasks
ADD templates $WORKDIR/ansible-zap/templates
#ADD vars $WORKDIR/ansible-zap/vars

# Here we continue to use add because
# there are a limited number of RUNs
# allowed.
ADD hosts /etc/ansible/hosts
ADD zap.yml $WORKDIR/ansible-zap/zap.yml

# Execute
#RUN pwd
#RUN ls -lrta
#RUN ansible --version
RUN echo localhost > hosts && ansible-playbook $WORKDIR/ansible-zap/zap.yml -c local -vvvv

# Clean up APT when done.
RUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

#EXPOSE 21:9999
ENTRYPOINT  ["/usr/local/zap/zap2/zap.sh"]
#CMD /usr/sbin/sshd -D
CMD ["-g", "deamon off;"]
